
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <title>1.3.1. Dockerfile &#8212; Article  文档</title>
    <link rel="stylesheet" href="../../../static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../static/jquery.js"></script>
    <script type="text/javascript" src="../../../static/underscore.js"></script>
    <script type="text/javascript" src="../../../static/doctools.js"></script>
    <script type="text/javascript" src="../../../static/language_data.js"></script>
    <script type="text/javascript" src="../../../static/translations.js"></script>
    <link rel="shortcut icon" href="../../../static/favicon.png"/>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../search.html" />
    <link rel="next" title="1.3.2. Docker命令收集" href="docker-cmd.html" />
    <link rel="prev" title="1.3. Docker" href="index.html" />
   
  <link rel="stylesheet" href="../../../static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="dockerfile">
<h1>1.3.1. Dockerfile<a class="headerlink" href="#dockerfile" title="永久链接至标题">¶</a></h1>
<div class="section" id="php">
<h2>1.3.1.1. PHP<a class="headerlink" href="#php" title="永久链接至标题">¶</a></h2>
<p>From <a class="reference external" href="https://www.jianshu.com/p/20fcca06e27e">https://www.jianshu.com/p/20fcca06e27e</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>FROM php:7.2-fpm

# 官方版本默认安装扩展: 
# Core, ctype, curl, date, dom
# fileinfo, filter, ftp, hash, iconv, json, libxml, mbstring, mysqlnd
# openssl, pcre, PDO, pdo_sqlite, Phar, posix, readline, Reflection
# session, SimpleXML, sodium, SPL, sqlite3, standard
# tokenizer, xml, xmlreader, xmlwriter, zlib

# 1.0.2 增加 bcmath, calendar, exif, gettext, sockets, dba, 
# mysqli, pcntl, pdo_mysql, shmop, sysvmsg, sysvsem, sysvshm 扩展
RUN docker-php-ext-install -j$(nproc) bcmath calendar exif gettext \
sockets dba mysqli pcntl pdo_mysql shmop sysvmsg sysvsem sysvshm

# 1.0.3 增加 bz2 扩展, 读写 bzip2（.bz2）压缩文件
RUN apt-get update &amp;&amp; \
apt-get install -y --no-install-recommends libbz2-dev &amp;&amp; \
rm -r /var/lib/apt/lists/* &amp;&amp; \
docker-php-ext-install -j$(nproc) bz2

# 1.0.4 增加 enchant 扩展, 拼写检查库
RUN apt-get update &amp;&amp; \
apt-get install -y --no-install-recommends libenchant-dev &amp;&amp; \
rm -r /var/lib/apt/lists/* &amp;&amp; \
docker-php-ext-install -j$(nproc) enchant

# 1.0.5 增加 GD 扩展. 图像处理
RUN apt-get update &amp;&amp; \
apt-get install -y --no-install-recommends libfreetype6-dev libjpeg62-turbo-dev libpng-dev &amp;&amp; \
rm -r /var/lib/apt/lists/* &amp;&amp; \
docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ &amp;&amp; \
docker-php-ext-install -j$(nproc) gd

# 1.0.6 增加 gmp 扩展, GMP
RUN apt-get update &amp;&amp; \
apt-get install -y --no-install-recommends libgmp-dev &amp;&amp; \
rm -r /var/lib/apt/lists/* &amp;&amp; \
docker-php-ext-install -j$(nproc) gmp

# 1.0.7 增加 soap wddx xmlrpc tidy xsl 扩展
RUN apt-get update &amp;&amp; \
apt-get install -y --no-install-recommends libxml2-dev libtidy-dev libxslt1-dev &amp;&amp; \
rm -r /var/lib/apt/lists/* &amp;&amp; \
docker-php-ext-install -j$(nproc) soap wddx xmlrpc tidy xsl

# 1.0.8 增加 zip 扩展
RUN apt-get update &amp;&amp; \
apt-get install -y --no-install-recommends libzip-dev &amp;&amp; \
rm -r /var/lib/apt/lists/* &amp;&amp; \
docker-php-ext-install -j$(nproc) zip

# 1.0.9 增加 snmp 扩展
RUN apt-get update &amp;&amp; \
apt-get install -y --no-install-recommends libsnmp-dev &amp;&amp; \
rm -r /var/lib/apt/lists/* &amp;&amp; \
docker-php-ext-install -j$(nproc) snmp

# 1.0.10 增加 pgsql, pdo_pgsql 扩展
RUN apt-get update &amp;&amp; \
apt-get install -y --no-install-recommends libpq-dev &amp;&amp; \
rm -r /var/lib/apt/lists/* &amp;&amp; \
docker-php-ext-install -j$(nproc) pgsql pdo_pgsql

# 1.0.11 增加 pspell 扩展
RUN apt-get update &amp;&amp; \
apt-get install -y --no-install-recommends libpspell-dev &amp;&amp; \
rm -r /var/lib/apt/lists/* &amp;&amp; \
docker-php-ext-install -j$(nproc) pspell

# 1.0.12 增加 recode 扩展
RUN apt-get update &amp;&amp; \
apt-get install -y --no-install-recommends librecode-dev &amp;&amp; \
rm -r /var/lib/apt/lists/* &amp;&amp; \
docker-php-ext-install -j$(nproc) recode

# 1.0.13 增加 PDO_Firebird 扩展
RUN apt-get update &amp;&amp; \
apt-get install -y --no-install-recommends firebird-dev &amp;&amp; \
rm -r /var/lib/apt/lists/* &amp;&amp; \
docker-php-ext-install -j$(nproc) pdo_firebird

# 1.0.14 增加 pdo_dblib 扩展
RUN apt-get update &amp;&amp; \
apt-get install -y --no-install-recommends freetds-dev &amp;&amp; \
rm -r /var/lib/apt/lists/* &amp;&amp; \
docker-php-ext-configure pdo_dblib --with-libdir=lib/x86_64-linux-gnu &amp;&amp; \
docker-php-ext-install -j$(nproc) pdo_dblib

# 1.0.15 增加 ldap 扩展
RUN apt-get update &amp;&amp; \
apt-get install -y --no-install-recommends libldap2-dev &amp;&amp; \
rm -r /var/lib/apt/lists/* &amp;&amp; \
docker-php-ext-configure ldap --with-libdir=lib/x86_64-linux-gnu &amp;&amp; \
docker-php-ext-install -j$(nproc) ldap

# 1.0.16 增加 imap 扩展
RUN apt-get update &amp;&amp; \
apt-get install -y --no-install-recommends libc-client-dev libkrb5-dev &amp;&amp; \
rm -r /var/lib/apt/lists/* &amp;&amp; \
docker-php-ext-configure imap --with-kerberos --with-imap-ssl &amp;&amp; \
docker-php-ext-install -j$(nproc) imap

# 1.0.17 增加 interbase 扩展
RUN apt-get update &amp;&amp; \
apt-get install -y --no-install-recommends firebird-dev &amp;&amp; \
rm -r /var/lib/apt/lists/* &amp;&amp; \
docker-php-ext-install -j$(nproc) interbase

# 1.0.18 增加 intl 扩展
RUN apt-get update &amp;&amp; \
apt-get install -y --no-install-recommends libicu-dev &amp;&amp; \
rm -r /var/lib/apt/lists/* &amp;&amp; \
docker-php-ext-install -j$(nproc) intl

# 1.0.19 增加 mcrypt 扩展
RUN apt-get update &amp;&amp; \ 
apt-get install -y --no-install-recommends libmcrypt-dev &amp;&amp; \
rm -r /var/lib/apt/lists/* &amp;&amp; \
pecl install mcrypt-1.0.1 &amp;&amp; \
docker-php-ext-enable mcrypt

# 1.0.20 imagick 扩展
RUN export CFLAGS=&quot;$PHP_CFLAGS&quot; CPPFLAGS=&quot;$PHP_CPPFLAGS&quot; LDFLAGS=&quot;$PHP_LDFLAGS&quot; &amp;&amp; \
apt-get update &amp;&amp; \
apt-get install -y --no-install-recommends libmagickwand-dev &amp;&amp; \
rm -rf /var/lib/apt/lists/* &amp;&amp; \
pecl install imagick-3.4.3 &amp;&amp; \
docker-php-ext-enable imagick

# 1.0.21 增加 Memcached 扩展
RUN apt-get update &amp;&amp; \
apt-get install -y --no-install-recommends zlib1g-dev libmemcached-dev &amp;&amp; \
rm -r /var/lib/apt/lists/* &amp;&amp; \
pecl install memcached &amp;&amp; \
docker-php-ext-enable memcached

# 1.0.22 redis 扩展
RUN pecl install redis-4.0.1 &amp;&amp; docker-php-ext-enable redis

# 1.0.23 增加 opcache 扩展
RUN docker-php-ext-configure opcache --enable-opcache &amp;&amp; docker-php-ext-install opcache

# 1.0.24 增加 odbc, pdo_odbc 扩展
RUN set -ex; \
docker-php-source extract; \
{ \
     echo &#39;# https://github.com/docker-library/php/issues/103#issuecomment-271413933&#39;; \
     echo &#39;AC_DEFUN([PHP_ALWAYS_SHARED],[])dnl&#39;; \
     echo; \
     cat /usr/src/php/ext/odbc/config.m4; \
} &gt; temp.m4; \
mv temp.m4 /usr/src/php/ext/odbc/config.m4; \
apt-get update; \
apt-get install -y --no-install-recommends unixodbc-dev; \
rm -rf /var/lib/apt/lists/*; \
docker-php-ext-configure odbc --with-unixODBC=shared,/usr; \
docker-php-ext-configure pdo_odbc --with-pdo-odbc=unixODBC,/usr; \
docker-php-ext-install odbc pdo_odbc; \
docker-php-source delete

# 镜像信息
LABEL Author=&quot;Name&quot;
LABEL Version=&quot;1.0.25-fpm&quot;
LABEL Description=&quot;PHP FPM 7.2 镜像. All extensions.&quot;
</pre></div>
</div>
<div class="section" id="symfony-drupal">
<h3>1.3.1.1.1. 个人配置，使用symfony, drupal<a class="headerlink" href="#symfony-drupal" title="永久链接至标题">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FROM</span> <span class="n">php</span><span class="p">:</span><span class="mf">7.2</span><span class="o">-</span><span class="n">fpm</span>

<span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span> \
    <span class="o">&amp;&amp;</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> \
        <span class="n">wget</span> \
        <span class="n">vim</span> \
        <span class="n">git</span> \
        <span class="nb">zip</span> \
        <span class="n">unzip</span> \
        <span class="n">libfreetype6</span><span class="o">-</span><span class="n">dev</span> \
        <span class="n">libjpeg62</span><span class="o">-</span><span class="n">turbo</span><span class="o">-</span><span class="n">dev</span> \
        <span class="n">libmcrypt</span><span class="o">-</span><span class="n">dev</span> \
        <span class="n">libpng</span><span class="o">-</span><span class="n">dev</span> \
        <span class="n">libicu</span><span class="o">-</span><span class="n">dev</span> \
    <span class="o">&amp;&amp;</span> <span class="n">docker</span><span class="o">-</span><span class="n">php</span><span class="o">-</span><span class="n">ext</span><span class="o">-</span><span class="n">install</span> <span class="n">opcache</span> \
    <span class="o">&amp;&amp;</span> <span class="n">docker</span><span class="o">-</span><span class="n">php</span><span class="o">-</span><span class="n">ext</span><span class="o">-</span><span class="n">configure</span> <span class="n">gd</span> <span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">freetype</span><span class="o">-</span><span class="nb">dir</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span><span class="o">/</span> <span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">jpeg</span><span class="o">-</span><span class="nb">dir</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">include</span><span class="o">/</span> \
    <span class="o">&amp;&amp;</span> <span class="n">docker</span><span class="o">-</span><span class="n">php</span><span class="o">-</span><span class="n">ext</span><span class="o">-</span><span class="n">install</span> <span class="n">gd</span> \
    <span class="o">&amp;&amp;</span> <span class="n">docker</span><span class="o">-</span><span class="n">php</span><span class="o">-</span><span class="n">ext</span><span class="o">-</span><span class="n">install</span> <span class="n">pdo</span> <span class="n">pdo_mysql</span> \
    <span class="o">&amp;&amp;</span> <span class="n">docker</span><span class="o">-</span><span class="n">php</span><span class="o">-</span><span class="n">ext</span><span class="o">-</span><span class="n">install</span> <span class="n">mysqli</span> <span class="o">&amp;&amp;</span> <span class="n">docker</span><span class="o">-</span><span class="n">php</span><span class="o">-</span><span class="n">ext</span><span class="o">-</span><span class="n">enable</span> <span class="n">mysqli</span> \
    <span class="o">&amp;&amp;</span> <span class="n">docker</span><span class="o">-</span><span class="n">php</span><span class="o">-</span><span class="n">ext</span><span class="o">-</span><span class="n">install</span> <span class="n">intl</span> \
    <span class="o">&amp;&amp;</span> <span class="n">curl</span> <span class="o">-</span><span class="n">sS</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">getcomposer</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">installer</span> \
        <span class="o">|</span> <span class="n">php</span> <span class="o">--</span> <span class="o">--</span><span class="n">install</span><span class="o">-</span><span class="nb">dir</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span> <span class="o">--</span><span class="n">filename</span><span class="o">=</span><span class="n">composer</span> \
    <span class="o">&amp;&amp;</span> <span class="n">composer</span> <span class="n">config</span> <span class="o">-</span><span class="n">g</span> <span class="n">repo</span><span class="o">.</span><span class="n">packagist</span> <span class="n">composer</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">packagist</span><span class="o">.</span><span class="n">phpcomposer</span><span class="o">.</span><span class="n">com</span> \

    <span class="o">&amp;&amp;</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">clean</span><span class="p">;</span> <span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">lists</span><span class="o">/*</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/*</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">tmp</span><span class="o">/*</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">doc</span><span class="o">/*</span>

<span class="n">COPY</span> <span class="n">php</span><span class="o">.</span><span class="n">ini</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">php</span><span class="o">/</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># php.ini</span>
<span class="n">memory_limit</span> <span class="o">=</span> <span class="mi">512</span><span class="n">M</span>
<span class="n">post_max_size</span> <span class="o">=</span> <span class="mi">100</span><span class="n">M</span>
<span class="n">upload_max_filesize</span> <span class="o">=</span> <span class="mi">100</span><span class="n">M</span>
<span class="n">max_execution_time</span> <span class="o">=</span> <span class="mi">60</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../static/favicon.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../../index.html">Article</a></h1>








<h3>导航</h3>
<p class="caption"><span class="caption-text">目录:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">1. 开发工具</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../sublime.html">1.1. Sublime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../git.html">1.2. Git</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">1.3. Docker</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../building/index.html">2. 构建工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../javascript/index.html">3. Javascript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../frame/index.html">4. 框架</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../frame-base/index.html">5. Web后端框架</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">1. 开发工具</a><ul>
  <li><a href="index.html">1.3. Docker</a><ul>
      <li>Previous: <a href="index.html" title="上一章">1.3. Docker</a></li>
      <li>Next: <a href="docker-cmd.html" title="下一章">1.3.2. Docker命令收集</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Nick Na.
      |
      <a href="../../../sources/article/tools/docker/Dockerfile.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>